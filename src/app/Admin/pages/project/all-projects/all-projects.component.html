<div class="flex justify-center items-center h-full p-6">
  <div class="bg-white p-6 rounded-xl shadow w-full max-w-5xl">
    <h2 class="text-center text-xl font-semibold mb-6">Liste des Projets</h2>

    <table class="w-full text-sm text-left border">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="px-4 py-2">Nom</th>
          <th class="px-4 py-2">Cat√©gorie</th>
          <th class="px-4 py-2">Description</th>
          <th class="px-4 py-2">Image</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>

      <tbody>
        @for (project of projects; track project.id; let i = $index) {
        <tr class="border-t hover:bg-gray-50">
          <td class="px-4 py-2">{{ project.name }}</td>
          <td class="px-4 py-2">{{ getCategoryName(+project.category_id) }}</td>

          <td class="px-4 py-2 max-w-xs">
            <div class="inline-flex items-start gap-2 flex-wrap">
              @if (isDescriptionExpanded(i)) {
              <span>{{ project.description }}</span>
              <button class="text-blue-500 text-xs" (click)="toggleDescription(i)">
                Lire moins
              </button>
              } @else {
              @if (project.description && project.description.length > 100) {
              <span>{{ project.description.substring(0, 100) }}...</span>
              <button class="text-blue-500 text-xs" (click)="toggleDescription(i)">
                Lire plus
              </button>
              } @else {
              <span>{{ project.description }}</span>
              }
              }
            </div>
          </td>

          <td class="px-4 py-2">
            <ng-container *ngIf="project.images && project.images.length > 0; else noImage">
              <div class="relative group">
                <img [src]="'http://localhost:8000/storage/' + project.images[0].image_url"
                  class="h-12 rounded cursor-pointer hover:opacity-80 transition-opacity"
                  (click)="showImages(project.images)" alt="Project image" />
                <div *ngIf="project.images.length > 1"
                  class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                  {{ project.images.length }}
                </div>
              </div>
            </ng-container>
            <ng-template #noImage>
              <span class="text-gray-400">Aucune image</span>
            </ng-template>
          </td>
          <td class="px-4 py-2">
            <button (click)="openDeleteModal(project.id!)" class="bg-red-500 text-white px-2 py-1 rounded">
              Supprimer
            </button>

            <button (click)="editProject(project.id!)" class="text-blue-600 hover:underline cursor-pointer">
              Modifier
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

</div>
@if (showModalDelete) {
<app-confirm-delete (onConfirm)="confirmDelete()" (onCancel)="cancelDelete()">
</app-confirm-delete>
}

<!-- Image Gallery Modal -->
@if (showModal) {
<div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" (click)="closeModal()">

  <div class="relative max-w-4xl max-h-screen p-4 w-full h-full flex flex-col" (click)="$event.stopPropagation()">

    <!-- Close Button -->
    <button class="absolute top-4 right-4 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-2"
      (click)="closeModal()">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Main Image Container -->
    <div class="flex-1 flex items-center justify-center relative">

      <!-- Previous Button -->
      @if (modalImages.length > 1 && currentImageIndex > 0) {
      <button
        class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-3 z-10"
        (click)="prevImage()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      }

      <!-- Image -->
      <img [src]="modalImages[currentImageIndex]" class="max-w-full max-h-full object-contain rounded-lg"
        alt="Project image" />

      <!-- Next Button -->
      @if (modalImages.length > 1 && currentImageIndex < modalImages.length - 1) { <button
        class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-3 z-10"
        (click)="nextImage()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        </button>
        }
    </div>

    <!-- Image Counter -->
    @if (modalImages.length > 1) {
    <div class="text-center text-white mt-4">
      {{ currentImageIndex + 1 }} / {{ modalImages.length }}
    </div>
    }

    <!-- Thumbnail Navigation -->
    @if (modalImages.length > 1) {
    <div class="flex justify-center mt-4 space-x-2 overflow-x-auto pb-2">
      @for (image of modalImages; track idx; let idx = $index) {
      <img [src]="image" class="h-16 w-16 object-cover rounded cursor-pointer border-2 transition-all duration-200"
        [class.border-white]="idx === currentImageIndex" [class.border-gray-500]="idx !== currentImageIndex"
        [class.opacity-100]="idx === currentImageIndex" [class.opacity-60]="idx !== currentImageIndex"
        (click)="goToImage(idx)" alt="Thumbnail" />
      }
    </div>
    }
  </div>
</div>
}